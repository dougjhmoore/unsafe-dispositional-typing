# docker-compose.yml
# IEEE TSE 2025 - Dispositional Typing Reproducibility

version: '3.8'

services:
  dispositional-typing:
    build: .
    container_name: dispositional-typing-ieee-tse
    volumes:
      # Mount results directory to host for easy access
      - ./results:/dispositional-typing/results
      - ./data:/dispositional-typing/data
    working_dir: /dispositional-typing
    environment:
      - TERM=xterm-256color
    # Keep container running for interactive use
    tty: true
    stdin_open: true

  # Quick analysis service (for reviewers in a hurry)
  quick-analysis:
    build: .
    container_name: dispositional-typing-quick
    volumes:
      - ./data:/dispositional-typing/data
    working_dir: /dispositional-typing
    command: >
      bash -c "
      . venv/bin/activate &&
      echo 'ğŸ”¬ Running quick scalability analysis...' &&
      cd scripts/analysis/scalability &&
      python scalability_analysis.py --output-dir ../../../data/scalability/ &&
      echo 'âœ… Quick analysis complete! Results in data/scalability/' &&
      echo 'ğŸ“Š Key results:' &&
      cat ../../../data/scalability/analysis_report.txt &&
      echo '' &&
      echo 'ğŸ–¼ï¸  Figure 1 generated: data/scalability/scalability_figure.png' &&
      echo 'ğŸ“ˆ TikZ coordinates: data/scalability/tikz_coordinates.txt'
      "

  # Full evaluation service (for thorough reviewers)
  full-evaluation:
    build: .
    container_name: dispositional-typing-full
    volumes:
      - ./data:/dispositional-typing/data
      - ./evaluation:/dispositional-typing/evaluation
    working_dir: /dispositional-typing
    command: >
      bash -c "
      . venv/bin/activate &&
      echo 'ğŸ—ï¸  Clang plugin already built during container creation' &&
      echo 'ğŸ”¬ Running full LLVM test suite evaluation...' &&
      cd scripts/evaluation &&
      ./driver.sh &&
      echo 'âœ… Full evaluation complete!' &&
      echo 'ğŸ“Š Results available in evaluation/ directory'
      "

  # Interactive development environment
  interactive:
    build: .
    container_name: dispositional-typing-dev
    volumes:
      - .:/dispositional-typing
    working_dir: /dispositional-typing
    environment:
      - TERM=xterm-256color
    tty: true
    stdin_open: true
    command: >
      bash -c "
      . venv/bin/activate &&
      echo 'ğŸ³ Dispositional Typing Development Environment Ready!' &&
      echo 'ğŸ“‹ Available commands:' &&
      echo '  make analysis    - Run scalability analysis' &&
      echo '  make evaluation  - Run full LLVM evaluation' &&
      echo '  tree data/       - View generated results' &&
      echo '  exit            - Leave container' &&
      echo '' &&
      /bin/bash
      "
